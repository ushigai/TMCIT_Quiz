{{define "quiz"}}
    {{template "header" .}}
    <body>
        <div id="area_statement"></div>
        <div id="area_choice1"></div>
        <div id="area_choice2"></div>
        <div id="area_choice3"></div>
        <div id="area_choice4"></div>
        
        <div id="area_Judge"></div>
        <div id="area_Next"></div>
        <div id="area_AnswerTime"></div>
        <script>
            var StartQuiz_i= function (i) {
                /* i回目のqiuzのスタート 
                ↓ のコードのっぺりでウケてる
                */
                area_Judge.innerHTML = "";
                area_Next.innerHTML = "";
                area_AnswerTime.innerHTML = "";

                var q = Quiz[i];
                var answers = [q.choice1, q.choice2, q.choice3, q.choice4];

                shuffle(answers);
                answers.unshift(0);
                var StartTime = performance.now();
                for (let i = 1; i < 5; i++) {
                    var c = "<input type='button' id='choice" + i + "' value='" + answers[i] + "' ";
                    c += "onclick='judge(UserAns=\"" + answers[i] + "\", ";
                    c += "StartTime="+StartTime+")'>";
                    document.getElementById("area_choice"+i).innerHTML = c;
                }
                area_statement.innerHTML = q.statement;
                quiz_i++;
            }

            var judge = function(UserAns, StartTime){ 
                /* 
                ユーザが答えを入力または制限時間が来たときにその正誤判定を行う 
                TODO: 正解時間の送信
                */
                
                /* タイムアウト検知用のあれこれ */
                if (GOING) { return; }
                GOING = true;

                /* 入力するなくそがって処理 */
                for (var i = 1; i < 5; i++) {
                    document.getElementById("choice"+i).disabled = true;
                }
                switch (UserAns) {
                    case "":
                        area_Judge.innerHTML = "<h3>Time is over!!!</h3>"
                        break;
                    case CorrectAns:
                        area_Judge.innerHTML = "<h3>Correct answer!!!</h3>"
                        Ncorrect++;
                        break;
                    default:
                        area_Judge.innerHTML = "<h3>Wrong answer!!!</h3>"
                        break;
                }
                area_AnswerTime.innerHTML = "回答時間：" + Math.round((performance.now() - StartTime) / 100) / 10 + " 秒";
                if (quiz_i == quiz_N) {
                    area_Next.innerHTML = "<h3>おわおわり</h3>";
                    area_Next.innerHTML += "<a href='/home'>ホームに戻る</a><br>";
                    area_Next.innerHTML += "正解率 : " + Ncorrect + " / " + quiz_N;
                } else {
                    GOING = false;
                    CorrectAns = Quiz[quiz_i].Answer;
                    UserAns = "";
                    area_Next.innerHTML = "<input type='button' value='つぎへ' onclick='StartQuiz_i(quiz_i)' >"
                }

            }

            function shuffle(arr){
                /* シャッフルするやつ */
                for(var i =arr.length-1 ; i>0 ;i--){
                    var j = Math.floor( Math.random() * (i + 1) );  
                    [arr[i],arr[j]]=[arr[j],arr[i]]; 
                }
            }

            var Quiz = JSON.stringify({{.}});
            Quiz = JSON.parse(Quiz);

            var area_Judge = document.getElementById("area_Judge");
            var area_Next = document.getElementById("area_Next");
            var area_AnswerTime = document.getElementById("area_AnswerTime");
            var area_statement = document.getElementById("area_statement")
            var quiz_i = 0;
            var quiz_N  = Quiz.length;

            var Ncorrect = 0;
            var GOING = false;
            var CorrectAns = Quiz[quiz_i].answer;
            var UserAns = "";
            StartQuiz_i(quiz_i);
        </script>
    </body>
    {{template "footer" .}}
{{end}}
